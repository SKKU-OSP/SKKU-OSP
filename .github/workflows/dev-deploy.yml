name: ê°œë°œ ì„œë²„ ìë™ ë°°í¬

on:
  push:
    branches:
      - develop

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: check git status
        run: |
          cd /home/sosd-dev/SKKU-OSP_FB && pwd && ls -al && git status

      - name: Pull latest code from develop branch
        run: |
          cd /home/sosd-dev/SKKU-OSP_FB && git checkout develop && git pull origin develop

      - name: Deploy with Docker Compose
        run: |
          cd /home/sosd-dev/SKKU-OSP_FB/deploy/dev && docker compose down && docker compose up -d --build

      - name: Notify Slack on Success
        if: success()
        run: |
          curl -X POST https://slack.com/api/chat.postMessage \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-type: application/json; charset=utf-8" \
            --data '{
              "channel": "#sosd-deploy",
              "text": "âœ… [ë°°í¬ ì„±ê³µ] ê°œë°œ ì„œë²„ê°€ ì„±ê³µì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.\nğŸ”— http://sosd-dev.skku.edu:8080/"
            }'

      - name: Notify Slack on Failure
        if: failure()
        run: |
          curl -X POST https://slack.com/api/chat.postMessage \
            -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
            -H "Content-type: application/json; charset=utf-8" \
            --data '{
              "channel": "#sosd-deploy",
              "text": "âŒ [ë°°í¬ ì‹¤íŒ¨] ê°œë°œ ì„œë²„ ë°°í¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.\nğŸ”— https://github.com/SKKU-OSP/SKKU-OSP/actions"
            }'
