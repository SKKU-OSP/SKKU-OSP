{% load tag_templatetag %}
{% load community_tag %}
{% load team_tag %}
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">팀 지원서 목록</h5>
        </div>
        <div class="modal-body w-100" style="min-height:400px;overflow-y:auto;">
            <ul class="nav nav-pills nav-fill" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="apply-recv-tab" data-bs-toggle="pill"
                        data-bs-target="#apply-recv" type="button" role="tab" aria-controls="apply-recv"
                        aria-selected="true">받은 지원서</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="apply-send-tab" data-bs-toggle="pill" data-bs-target="#apply-send"
                        type="button" role="tab" aria-controls="apply-send" aria-selected="false">보낸 지원서</button>
                </li>
            </ul>
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="apply-recv" role="tabpanel" aria-labelledby="apply-recv-tab"
                    tabindex="0">
                    {% get_admin_team request.user as admin_teams %}
                    {% for admin_team in admin_teams %}
                    {% get_teamappliedmessage_waited admin_team as waitedapplymessages %}
                    {% for applymsg in waitedapplymessages %}
                    <div class="team-apply-item">
                        <div class="team-apply-meta">
                            <div class="team-apply-teamname">
                                {{ applymsg.team.name }}
                                <i val="{{ applymsg.id }}" class="bi bi-caret-down-fill"
                                    style="cursor:pointer; display:inline-block;" data-bs-toggle="collapse"
                                    data-bs-target="#msg-id-{{ applymsg.id }}" aria-expanded="false"
                                    aria-controls="msg-id-{{ applymsg.id }}"
                                    role="button"></i>
                            </div>
                            <div onclick="location.href='/user/{{applymsg.account.user.username}}'" class="team-apply-user">
                                {{ applymsg.account.user.username }}
                            </div>
                            <div class="team-apply-action">
                                <button
                                    onclick="apply_result({{ applymsg.team.id }},'{{ applymsg.account.user.username }}',false)"
                                    class="btn-refuse">거절</button>
                                <button
                                    onclick="apply_result({{ applymsg.team.id }},'{{ applymsg.account.user.username }}',true)"
                                    class="btn-accept">수락</button>
                            </div>
                        </div>
                        <div id="msg-id-{{ applymsg.id }}" class="collapse team-apply-detail">
                            <div style="width: 20%;">지원동기</div>
                            <div class="team-apply-detail-body">
                                {{ applymsg.message|linebreaksbr }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endfor %}
                </div>
                <div class="tab-pane fade" id="apply-send" role="tabpanel" aria-labelledby="apply-send-tab"
                    tabindex="0">
                    {% get_sent_teamapply request.user as sent_teamapply %}
                    {% for applymsg in sent_teamapply %}
                    <div id="apply-{{applymsg.id}}" class="team-apply-item">
                        <div class="team-apply-meta">
                            <div class="team-apply-teamname">
                                {{ applymsg.team.name }}
                                <i val="{{ applymsg.id }}" class="bi bi-caret-down-fill"
                                    style="cursor:pointer; display:inline-block;" data-bs-toggle="collapse"
                                    data-bs-target="#msg-id-{{ applymsg.id }}" aria-expanded="false"
                                    aria-controls="msg-id-{{ applymsg.id }}"
                                    role="button"></i>
                            </div>
                            <div class="team-apply-user">
                            </div>
                            <div class="team-apply-action">
                                {% if applymsg.status == 0 %}
                                <button class="btn-wait" disabled>
                                    검토 대기중
                                </button>
                                {% elif applymsg.status == 1 %}
                                <button class="btn-accept" disabled>
                                    승인
                                </button>
                                {% elif applymsg.status == 2 %}
                                <button class="btn-refuse" disabled>
                                    거절
                                </button>
                                {% endif %}
                            </div>
                            <div class="team-apply-delete material-icons-outlined" onclick="ApplyDelete({{applymsg.id}})">
                                delete
                            </div>
                        </div>
                        <div id="msg-id-{{ applymsg.id }}" class="collapse team-apply-detail">
                            <div style="width: 20%;">지원동기</div>
                            <div class="team-apply-detail-body">
                                {{ applymsg.message|linebreaksbr }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
        </div>
    </div>
</div>